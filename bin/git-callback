#!/usr/bin/ruby

def log_with_duration(message)
  before = Time.now
  yield
  after = Time.now

  duration = ((after - before) * 1000).round(3)
  puts "\e[35m[git-callback] #{message} (took #{duration} ms)\e[0m"
end

def run_ctags
  git_directory = `git rev-parse --git-dir`.chomp
  tags_file_path = "#{git_directory}/tags"

  # Remove the previous `.git/tags` file
  system "rm -f #{tags_file_path}"

  # Generate a new `.git/tags` file
  system "git ls-files | ctags --tag-relative=yes -L - -f'#{tags_file_path}' 2>/dev/null"
end

log_with_duration("Updated ctags index") { run_ctags }
